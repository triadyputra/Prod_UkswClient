import{a as ie}from"./formatters-DULOiX1-.js";import{V as re,_ as ue,a as de}from"./VSnackbar-iehoD4iR.js";import{_ as X,c as me,V as ce,a as pe}from"./VDataTableServer-CvaayqLI.js";import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-D4kmOkS7.js";import{d as Z,r as d,ay as L,w as fe,aA as W,c as z,b as e,f as i,m as l,a2 as _,F as ee,e as c,v as F,a0 as w,Z as $,$ as ve,t as T,o as E,az as ge,X as O,g as H,a as be,q as Ve}from"./index-CfGr7fxM.js";import{a as J}from"./profile-men-CoeanpfQ.js";import{V as ke,$ as ae}from"./api-C8ws2ADT.js";import{u as j}from"./useApi-C0mHdd6N.js";import{V as _e}from"./VDialog-BhRlawkS.js";import{V as le,a as ye,b as he}from"./VCard-CoFJ3VGH.js";import{V as Q}from"./VCardText-DO2Slsmo.js";import{V as te}from"./VAvatar-CYHDSwcG.js";import{V as Ce,a as h}from"./VRow-BcSiJiKb.js";import{V as Ne}from"./VSpacer-Cp4UMCvi.js";import{V as Ue}from"./VDivider-C2MDwIC0.js";import{V as xe}from"./VChip-DD7TiWK_.js";import{V as Ae}from"./VImg-DjeIU0LB.js";import"./VOverlay-_lY9Rmx9.js";import"./forwardRefs-B931MWyl.js";import"./VTextField-md1QIUMW.js";import"./index-C4wfZp0O.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./VList-C7PTRKj5.js";import"./VMenu-DelKjUG5.js";/* empty css              */const De={class:"text-h4 mb-2"},Pe={class:"d-flex flex-column justify-center gap-4"},we={class:"d-flex flex-wrap gap-4"},Ee=Z({__name:"FormUser",props:{cardDetails:{default:()=>({Id:"",UserName:"",Email:"",FullName:"",PhoneNumber:"",Photo:"",IdCabang:"",Group:"",Active:!0})},isDialogVisible:{type:Boolean},isEditMode:{type:Boolean,default:!1}},emits:["submit","update:isDialogVisible","reload"],async setup(q,{emit:N}){let A,I;const g=q,y=N,m=d(!1),b=d(""),v=d("success"),t=d(structuredClone(L(g.cardDetails))),U=d([{title:"Aktif",value:!0},{title:"Non Aktif",value:!1}]);fe(()=>g.cardDetails,o=>{t.value=structuredClone(L(o))},{deep:!0,immediate:!0});const V=d(),k=d(!1),D=o=>{y("update:isDialogVisible",o)},S=async()=>{var o,a,u,s;try{if(k.value=!0,t.value.FullName===null||t.value.FullName===""){b.value="Fullname harus diisi",v.value="error",m.value=!0;return}if(t.value.UserName===null||t.value.UserName===""){b.value="Username harus diisi",v.value="error",m.value=!0;return}const p={Id:t.value.Id,UserName:t.value.UserName,Email:t.value.Email,FullName:t.value.FullName,PhoneNumber:t.value.PhoneNumber,Photo:t.value.Photo,Group:t.value.Group,IdCabang:t.value.IdCabang,Active:t.value.Active},n=g.isEditMode?"PUT":"POST",C=g.isEditMode?`api/Akun/${t.value.Id}`:"api/Akun",f=await ae(C,{method:n,body:p});((o=f==null?void 0:f.Metadata)==null?void 0:o.Code)==="200"?(b.value=((a=f==null?void 0:f.Metadata)==null?void 0:a.Message)||"Terjadi kesalahan!",v.value="success",m.value=!0,y("reload"),y("submit",t.value),y("update:isDialogVisible",!1)):(console.log((u=f==null?void 0:f.Metadata)==null?void 0:u.Message),b.value=((s=f==null?void 0:f.Metadata)==null?void 0:s.Message)||"Terjadi kesalahan!",v.value="error",m.value=!0)}catch(p){console.error("Gagal submit order:",p),b.value="Gagal submit order!",v.value="error",m.value=!0}finally{k.value=!1}},G=o=>{const a=new FileReader,{files:u}=o.target;if(u&&u.length){const s=u[0],p=["image/jpeg","image/png","image/gif"],n=100*1024;if(!p.includes(s.type)){b.value="Format file tidak valid (hanya JPG, PNG, GIF)",v.value="error",m.value=!0;return}if(s.size>n){b.value="Ukuran file maksimal 100KB",v.value="error",m.value=!0;return}a.readAsDataURL(s),a.onload=()=>{typeof a.result=="string"&&(t.value.Photo=a.result)}}},M=()=>{t.value.Photo=J},x=d([]),P=d([]);async function R(){try{const o=await j("/api/combo/ComboGroup");o!=null&&o.data?x.value=o.data.value:(x.value=[],console.warn("Data cabang kosong atau tidak valid:",o)),console.log("Respon Data:",o)}catch(o){o instanceof Error?(console.error("Error:",o.message),o.message.includes("Failed to fetch")&&console.error("Server tidak dapat dijangkau. Periksa koneksi backend atau CORS.")):console.error("Error tak terduga:",o)}finally{console.log("Fetch cabang selesai.")}}async function B(){try{const o=await j("/api/combo/ComboUnit");o!=null&&o.data?P.value=o.data.value:(P.value=[],console.warn("Data cabang kosong atau tidak valid:",o)),console.log("Respon Data:",o)}catch(o){o instanceof Error?(console.error("Error:",o.message),o.message.includes("Failed to fetch")&&console.error("Server tidak dapat dijangkau. Periksa koneksi backend atau CORS.")):console.error("Error tak terduga:",o)}finally{console.log("Fetch cabang selesai.")}}return[A,I]=W(()=>Promise.all([R(),B()])),await A,I(),(o,a)=>{const u=ue,s=Y,p=X;return E(),z(ee,null,[e(_e,{width:o.$vuetify.display.smAndDown?"auto":600,"model-value":g.isDialogVisible,"onUpdate:modelValue":D},{default:i(()=>[e(u,{onClick:a[0]||(a[0]=n=>D(!1))}),e(le,{class:"pa-2 pa-sm-10"},{default:i(()=>[e(ye,{class:"text-center"},{default:i(()=>[e(he,null,{default:i(()=>[c("h4",De,F(g.isEditMode?"EDIT AKUN":"ADD AKUN"),1)]),_:1})]),_:1}),e(Q,{class:"d-flex"},{default:i(()=>[e(te,{rounded:"",size:"100",class:"me-6",image:l(t).Photo||l(J)},null,8,["image"]),c("form",Pe,[c("div",we,[e(w,{color:"primary",size:"small",onClick:a[1]||(a[1]=n=>{var C;return(C=l(V))==null?void 0:C.click()})},{default:i(()=>[e($,{icon:"tabler-cloud-upload",class:"d-sm-none"}),a[11]||(a[11]=c("span",{class:"d-none d-sm-block"},"Upload new photo",-1))]),_:1,__:[11]}),c("input",{ref_key:"refInputEl",ref:V,type:"file",name:"file",accept:".jpeg,.png,.jpg,.gif",hidden:"",onInput:G},null,544),e(w,{type:"reset",size:"small",color:"secondary",variant:"tonal",onClick:M},{default:i(()=>[a[12]||(a[12]=c("span",{class:"d-none d-sm-block"},"Reset",-1)),e($,{icon:"tabler-refresh",class:"d-sm-none"})]),_:1,__:[12]})]),a[13]||(a[13]=c("p",{class:"text-body-1 mb-0"}," Allowed JPG, GIF, or PNG. Max size of 100K ",-1))])]),_:1}),e(Q,{class:"pt-6"},{default:i(()=>[e(ke,{onSubmit:ve(S,["prevent"])},{default:i(()=>[e(Ce,null,{default:i(()=>[e(h,{cols:"12"},{default:i(()=>[e(s,{modelValue:l(t).FullName,"onUpdate:modelValue":a[2]||(a[2]=n=>l(t).FullName=n),label:"Nama Lengkap",placeholder:"Superadmin",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(h,{cols:"12"},{default:i(()=>[e(s,{modelValue:l(t).UserName,"onUpdate:modelValue":a[3]||(a[3]=n=>l(t).UserName=n),label:"UserName",placeholder:"Superadmin",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(h,{cols:"12"},{default:i(()=>[e(s,{modelValue:l(t).Email,"onUpdate:modelValue":a[4]||(a[4]=n=>l(t).Email=n),label:"Email",placeholder:"Superadmin@desa.com",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(h,{cols:"12"},{default:i(()=>[e(s,{modelValue:l(t).PhoneNumber,"onUpdate:modelValue":a[5]||(a[5]=n=>l(t).PhoneNumber=n),label:"Hp",placeholder:"0812998000001",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(h,{cols:"12"},{default:i(()=>[e(p,{modelValue:l(t).IdCabang,"onUpdate:modelValue":a[6]||(a[6]=n=>l(t).IdCabang=n),label:"Unit / Entitas",placeholder:"Pilih salah satu",items:l(P),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(h,{cols:"12",sm:"12"},{default:i(()=>[e(p,{modelValue:l(t).Group,"onUpdate:modelValue":a[7]||(a[7]=n=>l(t).Group=n),label:"Group Akses",placeholder:"Pilih salah satu",items:l(x),multiple:"",chips:"","persistent-hint":"",clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(h,{cols:"12"},{default:i(()=>[e(p,{modelValue:l(t).Active,"onUpdate:modelValue":a[8]||(a[8]=n=>l(t).Active=n),label:"Status",placeholder:"Status",items:l(U),clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(h,{cols:"12",class:"text-center"},{default:i(()=>[e(w,{class:"me-4",type:"submit",loading:l(k)},{default:i(()=>a[14]||(a[14]=[T(" Submit ")])),_:1,__:[14]},8,["loading"]),e(w,{color:"secondary",variant:"tonal",onClick:a[9]||(a[9]=n=>D(!1))},{default:i(()=>a[15]||(a[15]=[T(" Cancel ")])),_:1,__:[15]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),e(re,{modelValue:l(m),"onUpdate:modelValue":a[10]||(a[10]=n=>_(m)?m.value=n:null),transition:"scale-transition",location:"top end",variant:"flat",color:l(v),timeout:1e3},{default:i(()=>[T(F(l(b)),1)]),_:1},8,["modelValue","color"])],64)}}}),Fe={class:"d-flex flex-wrap gap-4 ma-6"},Ie={class:"d-flex align-center"},Se={class:"d-flex gap-4 flex-wrap align-center"},Ge={class:"d-flex align-center gap-x-4"},Te={key:1},$e={class:"d-flex flex-column"},Me={class:"text-base"},Re={class:"text-sm"},ma=Z({__name:"index",async setup(q){let N,A;const I=[{title:"FullName",key:"FullName",sortable:!1},{title:"Email",key:"Email",sortable:!1},{title:"PhoneNumber",key:"PhoneNumber",sortable:!1},{title:"Group",key:"Group",sortable:!1},{title:"Active",key:"Active",sortable:!1},{title:"Actions",key:"actions",sortable:!1,width:"5%"}],g=d(!1),y=d(!1),m=d(""),b=d([]),v=d(!1),t=d(null),U=d({Id:"",UserName:"",Email:"",FullName:"",PhoneNumber:"",Photo:"",IdCabang:"",Group:"",Active:!0}),V=d(10),k=d(1),D=ge({filter:m,page:k,pageSize:V}),{data:S,execute:G}=([N,A]=W(()=>j(me("/api/Akun/GetListAkun",{query:D}))),N=await N,A(),N),M=O(()=>{var u;return((u=S.value)==null?void 0:u.Data)??[]}),x=O(()=>{var u;return((u=S.value)==null?void 0:u.TotalCount)??0}),P=()=>{U.value={Id:"",UserName:"",Email:"",FullName:"",PhoneNumber:"",Photo:"",IdCabang:"",Group:"",Active:!0},y.value=!1,g.value=!0},R=u=>{U.value={...u},y.value=!0,g.value=!0},B=u=>{t.value=u,v.value=!0},o=async u=>{var s,p;if(!(!u||!t.value))try{const n=await ae(`/api/Akun/${t.value.Id}`,{method:"DELETE"});((s=n==null?void 0:n.Metadata)==null?void 0:s.Code)==="200"?await G():console.error("Gagal menghapus data:",(p=n==null?void 0:n.Metadata)==null?void 0:p.Message)}catch(n){console.error("Terjadi kesalahan koneksi ke server:",n)}finally{t.value=null}},a=u=>u?{text:"Aktif",color:"success",icon:"tabler-check"}:{text:"Non Aktif",color:"error",icon:"tabler-x"};return(u,s)=>{var K;const p=Y,n=X,C=be("IconBtn"),f=pe,oe=Ee,se=de;return E(),z(ee,null,[c("div",null,[e(le,{title:"User",class:"mb-6"},{default:i(()=>[c("div",Fe,[c("div",Ie,[e(p,{modelValue:l(m),"onUpdate:modelValue":s[0]||(s[0]=r=>_(m)?m.value=r:null),placeholder:"Cari Data",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(Ne),c("div",Se,[e(n,{modelValue:l(V),"onUpdate:modelValue":s[1]||(s[1]=r=>_(V)?V.value=r:null),items:[5,10,20,25,50]},null,8,["modelValue"]),e(w,{color:"primary","prepend-icon":"tabler-plus",onClick:s[2]||(s[2]=()=>P())},{default:i(()=>s[9]||(s[9]=[T(" Tambah ")])),_:1,__:[9]})])]),e(Ue,{class:"mt-4"}),e(ce,{"items-per-page":l(V),"onUpdate:itemsPerPage":s[4]||(s[4]=r=>_(V)?V.value=r:null),"model-value":l(b),"onUpdate:modelValue":s[5]||(s[5]=r=>_(b)?b.value=r:null),page:l(k),"onUpdate:page":s[6]||(s[6]=r=>_(k)?k.value=r:null),headers:I,items:l(M),"items-length":l(x),class:"text-no-wrap"},{"item.FullName":i(({item:r})=>[c("div",Ge,[e(te,{size:"34",variant:r.Photo?void 0:"tonal",color:r.Photo?void 0:"success"},{default:i(()=>[r.Photo?(E(),H(Ae,{key:0,src:r.Photo},null,8,["src"])):(E(),z("span",Te,F(("avatarText"in u?u.avatarText:l(ie))(r.FullName)),1))]),_:2},1032,["variant","color"]),c("div",$e,[c("h6",Me,F(r.FullName),1),c("div",Re,F(r.UserName),1)])])]),"item.Active":i(({item:r})=>[e(xe,Ve(a(r.Active),{label:"",size:"small"}),null,16)]),"item.actions":i(({item:r})=>[e(C,null,{default:i(()=>[e($,{icon:"tabler-edit",onClick:ne=>R(r)},null,8,["onClick"])]),_:2},1024),e(C,null,{default:i(()=>[e($,{icon:"tabler-trash",color:"error",onClick:ne=>B(r)},null,8,["onClick"])]),_:2},1024)]),bottom:i(()=>[e(f,{page:l(k),"onUpdate:page":s[3]||(s[3]=r=>_(k)?k.value=r:null),"items-per-page":l(V),"total-items":l(x)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1})]),(E(),H(oe,{key:((K=l(U))==null?void 0:K.Id)??"new","is-dialog-visible":l(g),"onUpdate:isDialogVisible":s[7]||(s[7]=r=>_(g)?g.value=r:null),"card-details":l(U),"is-edit-mode":l(y),onReload:l(G)},null,8,["is-dialog-visible","card-details","is-edit-mode","onReload"])),e(se,{"is-dialog-visible":l(v),"onUpdate:isDialogVisible":s[8]||(s[8]=r=>_(v)?v.value=r:null),"confirmation-question":"Apakah Anda yakin ingin menghapus data ini?","confirm-title":"Data Terhapus!","confirm-msg":"Data telah berhasil dihapus.","cancel-title":"Dibatalkan","cancel-msg":"Penghapusan dibatalkan.","confirm-text":"Ya, Hapus","cancel-text":"Batal","confirm-color":"error",onConfirm:o},null,8,["is-dialog-visible"])],64)}}});export{ma as default};
