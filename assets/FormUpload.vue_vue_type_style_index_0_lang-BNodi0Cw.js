import{_ as ue,V as re}from"./VSnackbar-iehoD4iR.js";import{$ as ce}from"./api-C8ws2ADT.js";import{V as de}from"./VDialog-BhRlawkS.js";import{b as fe,c as me,V as ve}from"./VCard-CoFJ3VGH.js";import{V as pe}from"./VCardText-DO2Slsmo.js";import{u as ge,V as N,a as j,b as Ve,m as ye,c as be}from"./VTextField-md1QIUMW.js";import{f as he}from"./forwardRefs-B931MWyl.js";import{a5 as Ce,a6 as ke,ah as we,a7 as De,X as y,aJ as O,r as h,Y as Ie,aK as Se,w as Pe,a9 as Fe,aE as Be,b as l,q as R,aL as G,F as A,ax as xe,aM as Re,d as Ae,g as _e,f,t as S,v as L,m as b,a2 as ze,a0 as q,o as Me}from"./index-CfGr7fxM.js";import{V as Ue}from"./VChip-DD7TiWK_.js";import{V as $e}from"./VSpacer-Cp4UMCvi.js";const Te=ke({chips:Boolean,counter:Boolean,counterSizeString:{type:String,default:"$vuetify.fileInput.counterSize"},counterString:{type:String,default:"$vuetify.fileInput.counter"},hideInput:Boolean,multiple:Boolean,showSize:{type:[Boolean,Number,String],default:!1,validator:e=>typeof e=="boolean"||[1e3,1024].includes(Number(e))},...ye({prependIcon:"$file"}),modelValue:{type:[Array,Object],default:e=>e.multiple?[]:null,validator:e=>G(e).every(p=>p!=null&&typeof p=="object")},...Ve({clearable:!0})},"VFileInput"),Ee=Ce()({name:"VFileInput",inheritAttrs:!1,props:Te(),emits:{"click:control":e=>!0,"mousedown:control":e=>!0,"update:focused":e=>!0,"update:modelValue":e=>!0},setup(e,p){let{attrs:C,emit:g,slots:o}=p;const{t:V}=we(),s=De(e,"modelValue",e.modelValue,a=>G(a),a=>!e.multiple&&Array.isArray(a)?a[0]:a),{isFocused:u,focus:P,blur:m}=ge(e),n=y(()=>typeof e.showSize!="boolean"?e.showSize:void 0),v=y(()=>(s.value??[]).reduce((a,t)=>{let{size:c=0}=t;return a+c},0)),i=y(()=>O(v.value,n.value)),F=y(()=>(s.value??[]).map(a=>{const{name:t="",size:c=0}=a;return e.showSize?`${t} (${O(c,n.value)})`:t})),H=y(()=>{var t;const a=((t=s.value)==null?void 0:t.length)??0;return e.showSize?V(e.counterSizeString,a,i.value):V(e.counterString,a)}),_=h(),z=h(),r=h(),J=Ie(()=>u.value||e.active),M=y(()=>["plain","underlined"].includes(e.variant)),w=Se(!1);function B(){var a;r.value!==document.activeElement&&((a=r.value)==null||a.focus()),u.value||P()}function K(a){var t;(t=r.value)==null||t.click()}function X(a){g("mousedown:control",a)}function Y(a){var t;(t=r.value)==null||t.click(),g("click:control",a)}function Q(a){a.stopPropagation(),B(),xe(()=>{s.value=[],Re(e["onClick:clear"],a)})}function W(a){a.preventDefault(),a.stopImmediatePropagation(),w.value=!0}function Z(a){a.preventDefault(),w.value=!1}function ee(a){var c,D;if(a.preventDefault(),a.stopImmediatePropagation(),w.value=!1,!((D=(c=a.dataTransfer)==null?void 0:c.files)!=null&&D.length)||!r.value)return;const t=new DataTransfer;for(const U of a.dataTransfer.files)t.items.add(U);r.value.files=t.files,r.value.dispatchEvent(new Event("change",{bubbles:!0}))}return Pe(s,a=>{(!Array.isArray(a)||!a.length)&&r.value&&(r.value.value="")}),Fe(()=>{const a=!!(o.counter||e.counter),t=!!(a||o.details),[c,D]=Be(C),{modelValue:U,...ae}=N.filterProps(e),le=j.filterProps(e);return l(N,R({ref:_,modelValue:e.multiple?s.value:s.value[0],class:["v-file-input",{"v-file-input--chips":!!e.chips,"v-file-input--dragging":w.value,"v-file-input--hide":e.hideInput,"v-input--plain-underlined":M.value},e.class],style:e.style,"onClick:prepend":K},c,ae,{centerAffix:!M.value,focused:u.value}),{...o,default:x=>{let{id:I,isDisabled:k,isDirty:$,isReadonly:T,isValid:te}=x;return l(j,R({ref:z,"prepend-icon":e.prependIcon,onMousedown:X,onClick:Y,"onClick:clear":Q,"onClick:prependInner":e["onClick:prependInner"],"onClick:appendInner":e["onClick:appendInner"]},le,{id:I.value,active:J.value||$.value,dirty:$.value||e.dirty,disabled:k.value,focused:u.value,error:te.value===!1,onDragover:W,onDrop:ee}),{...o,default:ne=>{var E;let{props:{class:oe,...ie}}=ne;return l(A,null,[l("input",R({ref:r,type:"file",readonly:T.value,disabled:k.value,multiple:e.multiple,name:e.name,onClick:d=>{d.stopPropagation(),T.value&&d.preventDefault(),B()},onChange:d=>{if(!d.target)return;const se=d.target;s.value=[...se.files??[]]},onDragleave:Z,onFocus:B,onBlur:m},ie,D),null),l("div",{class:oe},[!!((E=s.value)!=null&&E.length)&&!e.hideInput&&(o.selection?o.selection({fileNames:F.value,totalBytes:v.value,totalBytesReadable:i.value}):e.chips?F.value.map(d=>l(Ue,{key:d,size:"small",text:d},null)):F.value.join(", "))])])}})},details:t?x=>{var I,k;return l(A,null,[(I=o.details)==null?void 0:I.call(o,x),a&&l(A,null,[l("span",null,null),l(be,{active:!!((k=s.value)!=null&&k.length),value:H.value,disabled:e.disabled},o.counter)])])}:void 0})}),he({},_,z,r)}}),Ye=Ae({__name:"FormUpload",props:{isDialogVisible:{type:Boolean},title:{},apiUrl:{}},emits:["update:isDialogVisible","reload"],setup(e,{emit:p}){const C=e,g=p,o=h(null),V=h(!1),s=m=>{g("update:isDialogVisible",m)},u=h({show:!1,message:"",color:"success"}),P=async()=>{var n,v;if(!o.value){u.value={show:!0,message:"Harap pilih file!",color:"error"};return}const m=new FormData;m.append("file",o.value);try{V.value=!0;const i=await ce(C.apiUrl,{method:"POST",body:m});((n=i==null?void 0:i.Metadata)==null?void 0:n.Code)==="200"?(u.value={show:!0,message:i.Metadata.Message,color:"success"},g("reload"),g("update:isDialogVisible",!1)):u.value={show:!0,message:((v=i.Metadata)==null?void 0:v.Message)||"Gagal upload",color:"error"}}catch{u.value={show:!0,message:"Upload gagal!",color:"error"}}finally{V.value=!1}};return(m,n)=>{const v=ue;return Me(),_e(de,{"model-value":C.isDialogVisible,width:"500","onUpdate:modelValue":s},{default:f(()=>[l(v,{onClick:n[0]||(n[0]=i=>s(!1))}),l(ve,null,{default:f(()=>[l(fe,{class:"pa-4 text-center"},{default:f(()=>[S(L(C.title),1)]),_:1}),l(pe,null,{default:f(()=>[l(Ee,{modelValue:b(o),"onUpdate:modelValue":n[1]||(n[1]=i=>ze(o)?o.value=i:null),label:"Pilih file Excel",accept:".xlsx,.xls,.csv","prepend-icon":"tabler-file"},null,8,["modelValue"])]),_:1}),l(me,null,{default:f(()=>[l($e),l(q,{variant:"tonal",color:"secondary",onClick:n[2]||(n[2]=i=>s(!1))},{default:f(()=>n[4]||(n[4]=[S(" Cancel ")])),_:1,__:[4]}),l(q,{color:"primary",loading:b(V),onClick:P},{default:f(()=>n[5]||(n[5]=[S(" Upload ")])),_:1,__:[5]},8,["loading"])]),_:1})]),_:1}),l(re,{modelValue:b(u).show,"onUpdate:modelValue":n[3]||(n[3]=i=>b(u).show=i),color:b(u).color,transition:"scale-transition",location:"top end",timeout:1200},{default:f(()=>[S(L(b(u).message),1)]),_:1},8,["modelValue","color"])]),_:1},8,["model-value"])}}});export{Ye as _};
