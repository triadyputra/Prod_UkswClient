import{V as ce,_ as fe,a as Y,b as ve,c as ge,d as be,e as Ve}from"./VDataTableServer-VDRasRhn.js";import{_ as Ue}from"./FormUpload.vue_vue_type_style_index_0_lang-B6m50Tr9.js";import{_ as Ce}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-HR6JCe6v.js";import{V as ke,_ as Z,$ as J}from"./api-CFqYjHKn.js";import{d as W,r as u,ay as H,w as B,G as De,c as ee,b as t,f as d,m as e,a2 as g,F as ae,e as S,v as R,$ as _e,g as L,l as F,a0 as h,t as N,o as $,ad as ye,az as Ne,aA as Ae,X as Q,a as Ie,Z as X}from"./index-Bk01GPF6.js";import{u as O}from"./useApi-CUH5TMB_.js";import{V as Pe}from"./VDialog-l5urwQ-J.js";import{V as te,a as we,b as xe}from"./VCard-B67OKyuw.js";import{V as Ee}from"./VCardText-COOODWw-.js";import{V as $e,a as M}from"./VRow-CRgzaJ64.js";import{V as Me}from"./VSpacer-Dv1PNfGM.js";import{V as Se}from"./VDivider-BX1ytI_T.js";import"./VOverlay-D8bXdJVy.js";import"./forwardRefs-B931MWyl.js";import"./VImg-BebPicZ-.js";import"./VTextField-Da7XNvPe.js";import"./index-C4wfZp0O.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./VList-AkIudXen.js";import"./VAvatar-NMeyVpuN.js";import"./VMenu-B9WiSIlX.js";import"./VChip-DSDdsHLF.js";/* empty css              */function Te(A){return A==null||A===""?"":Number(A).toLocaleString("id-ID")}const Ke={class:"text-h4 mb-2"},Le=W({__name:"FormLaporan",props:{cardDetails:{default:()=>({Id:"",Periode:"",Kode:"",Nama:"",Nilai:0,UnitId:""})},isDialogVisible:{type:Boolean},isEditMode:{type:Boolean,default:!1},optUnit:{default:()=>[]},unit:{default:null}},emits:["submit","update:isDialogVisible","reload"],setup(A,{emit:I}){const p=A,P=I,V=u(!1),c=u(""),f=u("success"),o=u(structuredClone(H(p.cardDetails))),D=u(p.optUnit??[]),U=u([]),C=u(p.unit??null),k=u(!1);B(()=>p.cardDetails,s=>{o.value=structuredClone(H(s))},{deep:!0,immediate:!0}),B(()=>p.optUnit,s=>{D.value=s??[]},{immediate:!0});const _=s=>{P("update:isDialogVisible",s)},w=async()=>{var s,a,m;try{if(k.value=!0,!o.value.Periode){c.value="Periode harus diisi",f.value="error",V.value=!0;return}if(!o.value.Kode){c.value="Kode COA harus diisi",f.value="error",V.value=!0;return}const b={Id:o.value.Id,Periode:o.value.Periode,Kode:o.value.Kode,Nilai:o.value.Nilai,UnitId:C.value??o.value.UnitId},x=p.isEditMode?"PUT":"POST",E=p.isEditMode?`api/UploadLaporan/${o.value.Id}`:"api/UploadLaporan",r=await J(E,{method:x,body:b});((s=r==null?void 0:r.Metadata)==null?void 0:s.Code)==="200"?(c.value=((a=r==null?void 0:r.Metadata)==null?void 0:a.Message)||"Berhasil disimpan!",f.value="success",V.value=!0,P("reload"),P("submit",o.value),P("update:isDialogVisible",!1)):(c.value=((m=r==null?void 0:r.Metadata)==null?void 0:m.Message)||"Terjadi kesalahan!",f.value="error",V.value=!0)}catch(b){console.error("Gagal submit order:",b),c.value="Gagal submit order!",f.value="error",V.value=!0}finally{k.value=!1}};async function y(s){console.log("Panggil");const a=s||C.value||o.value.UnitId;if(!a){console.warn("⚠️ UnitId tidak tersedia, fetch COA dibatalkan.");return}try{const m=`/api/combo/ComboCoaUnit?unit=${encodeURIComponent(a)}`,b=await O(m);console.log("Respon Data COA:",b),U.value=b.data.value}catch(m){console.error("❌ Error Fetch COA:",m),U.value=[]}}return B(()=>o.value.UnitId,(s,a)=>{s&&s!==a&&y(s)},{immediate:!0}),De(()=>{const s=o.value.UnitId||C.value;s&&y(s),console.log(s)}),(s,a)=>{const m=fe,b=Y,x=Z,E=Ce;return $(),ee(ae,null,[t(Pe,{width:s.$vuetify.display.smAndDown?"auto":600,"model-value":p.isDialogVisible,"onUpdate:modelValue":_},{default:d(()=>[t(m,{onClick:a[0]||(a[0]=r=>_(!1))}),t(te,{class:"pa-2 pa-sm-10"},{default:d(()=>[t(we,{class:"text-center"},{default:d(()=>[t(xe,null,{default:d(()=>[S("h4",Ke,R(p.isEditMode?"EDIT LAPORAN KEUANGAN":"ADD LAPORAN KEUANGAN"),1)]),_:1})]),_:1}),t(Ee,{class:"pt-6"},{default:d(()=>[t(ke,{onSubmit:_e(w,["prevent"])},{default:d(()=>[t($e,null,{default:d(()=>[t(M,{cols:"12"},{default:d(()=>[e(C)?F("",!0):($(),L(b,{key:0,modelValue:e(o).UnitId,"onUpdate:modelValue":a[1]||(a[1]=r=>e(o).UnitId=r),label:"Unit / Entitas",placeholder:"Pilih Unit / Entitas",items:e(D),autocomplete:"off"},null,8,["modelValue","items"]))]),_:1}),t(M,{cols:"12"},{default:d(()=>[t(x,{modelValue:e(o).Periode,"onUpdate:modelValue":a[2]||(a[2]=r=>e(o).Periode=r),label:"Periode",placeholder:"112025",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(M,{cols:"12"},{default:d(()=>[t(E,{modelValue:e(o).Kode,"onUpdate:modelValue":a[3]||(a[3]=r=>e(o).Kode=r),label:"Kode Coa",items:e(U),"item-title":"title","item-value":"value",placeholder:"Pilih Salah satu",clearable:"","clear-icon":"tabler-x",autocomplete:"off"},null,8,["modelValue","items"])]),_:1}),t(M,{cols:"12"},{default:d(()=>[t(x,{modelValue:e(o).Nilai,"onUpdate:modelValue":a[4]||(a[4]=r=>e(o).Nilai=r),label:"Nilai",type:"number",placeholder:"112025",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t(M,{cols:"12",class:"text-center"},{default:d(()=>[t(h,{class:"me-4",type:"submit",loading:e(k)},{default:d(()=>a[7]||(a[7]=[N(" Submit ")])),_:1,__:[7]},8,["loading"]),t(h,{color:"secondary",variant:"tonal",onClick:a[5]||(a[5]=r=>_(!1))},{default:d(()=>a[8]||(a[8]=[N(" Cancel ")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),t(ce,{modelValue:e(V),"onUpdate:modelValue":a[6]||(a[6]=r=>g(V)?V.value=r:null),transition:"scale-transition",location:"top end",variant:"flat",color:e(f),timeout:1e3},{default:d(()=>[N(R(e(c)),1)]),_:1},8,["modelValue","color"])],64)}}}),Re={class:"d-flex flex-wrap gap-4 ma-6"},he={class:"d-flex align-center"},Be={class:"d-flex gap-4 flex-wrap align-center"},ua=W({__name:"index",async setup(A){var j;let I,p;const P=[{title:"Periode",key:"Periode",sortable:!1},{title:"Kode COA",key:"Kode",sortable:!1},{title:"Nama COA",key:"Nama",sortable:!1},{title:"Nilai",key:"Nilai",sortable:!1,align:"end"},{title:"Unit / Entitas",key:"Unit",sortable:!1},{title:"Actions",key:"actions",sortable:!1,width:"5%"}],c=(j=ye("userData").value)==null?void 0:j.unit,f=u([]),o=u(null),D=u(!1),U=u(!1),C=u(!1),k=u(""),_=u([]),w=u(!1),y=u(null),s=u({Id:"",Periode:"",Kode:"",Nama:"",Nilai:0,UnitId:""}),a=u(10),m=u(1);async function b(){try{const i=await O("/api/combo/ComboUnit");i!=null&&i.data?f.value=i.data.value??[]:(f.value=[],console.warn("Data cabang kosong atau tidak valid:",i)),console.log("Respon cabang:",i)}catch(i){i instanceof Error?(console.error("Error:",i.message),i.message.includes("Failed to fetch")&&console.error("Server tidak dapat dijangkau. Periksa koneksi backend atau CORS.")):console.error("Error tak terduga:",i)}finally{console.log("Fetch cabang selesai.")}}const x=Ne({filter:k,unit:c??o,page:m,pageSize:a}),{data:E,execute:r}=([I,p]=Ae(()=>O(ge("/api/UploadLaporan/GetListLaporan",{query:x}))),I=await I,p(),I),le=Q(()=>{var i;return((i=E.value)==null?void 0:i.Data)??[]}),G=Q(()=>{var i;return((i=E.value)==null?void 0:i.TotalCount)??0}),oe=()=>{D.value=!0},ie=()=>{s.value={Id:"",Periode:"",Kode:"",Nama:"",Nilai:0,UnitId:""},C.value=!1,U.value=!0},ne=i=>{s.value={...i},C.value=!0,U.value=!0},se=i=>{y.value=i,w.value=!0},re=async i=>{var l,T;if(!(!i||!y.value))try{const v=await J(`/api/UploadLaporan/${y.value.Id}`,{method:"DELETE"});((l=v==null?void 0:v.Metadata)==null?void 0:l.Code)==="200"?await r():console.error("Gagal menghapus data:",(T=v==null?void 0:v.Metadata)==null?void 0:T.Message)}catch(v){console.error("Terjadi kesalahan koneksi ke server:",v)}finally{y.value=null}};return b(),(i,l)=>{var z;const T=Z,v=Y,q=Ie("IconBtn"),de=Ve,ue=Le,me=Ue,pe=ve;return $(),ee(ae,null,[S("div",null,[t(te,{title:"Laporan Keuangan",class:"mb-6"},{default:d(()=>[S("div",Re,[S("div",he,[t(T,{modelValue:e(k),"onUpdate:modelValue":l[0]||(l[0]=n=>g(k)?k.value=n:null),placeholder:"Cari Data",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(c)?F("",!0):($(),L(v,{key:0,modelValue:e(o),"onUpdate:modelValue":l[1]||(l[1]=n=>g(o)?o.value=n:null),placeholder:"Pilih Unit / Entitas",items:e(f)},null,8,["modelValue","items"])),t(Me),S("div",Be,[t(v,{modelValue:e(a),"onUpdate:modelValue":l[2]||(l[2]=n=>g(a)?a.value=n:null),items:[5,10,20,25,50]},null,8,["modelValue"]),e(c)?($(),L(h,{key:0,color:"primary","prepend-icon":"tabler-file-upload",onClick:l[3]||(l[3]=()=>oe())},{default:d(()=>l[12]||(l[12]=[N(" Upload ")])),_:1,__:[12]})):F("",!0),t(h,{color:"primary","prepend-icon":"tabler-plus",onClick:l[4]||(l[4]=()=>ie())},{default:d(()=>l[13]||(l[13]=[N(" Tambah ")])),_:1,__:[13]})])]),t(Se,{class:"mt-4"}),t(be,{"items-per-page":e(a),"onUpdate:itemsPerPage":l[6]||(l[6]=n=>g(a)?a.value=n:null),"model-value":e(_),"onUpdate:modelValue":l[7]||(l[7]=n=>g(_)?_.value=n:null),page:e(m),"onUpdate:page":l[8]||(l[8]=n=>g(m)?m.value=n:null),headers:P,items:e(le),"items-length":e(G),class:"text-no-wrap"},{"item.Unit":d(({item:n})=>{var K;return[N(R((K=n.MasterUnit)==null?void 0:K.Nama),1)]}),"item.Nilai":d(({item:n})=>[N(R(("formatNumber"in i?i.formatNumber:e(Te))(n.Nilai)),1)]),"item.actions":d(({item:n})=>[t(q,null,{default:d(()=>[t(X,{icon:"tabler-edit",onClick:K=>ne(n)},null,8,["onClick"])]),_:2},1024),t(q,null,{default:d(()=>[t(X,{icon:"tabler-trash",color:"error",onClick:K=>se(n)},null,8,["onClick"])]),_:2},1024)]),bottom:d(()=>[t(de,{page:e(m),"onUpdate:page":l[5]||(l[5]=n=>g(m)?m.value=n:null),"items-per-page":e(a),"total-items":e(G)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1})]),($(),L(ue,{key:((z=e(s))==null?void 0:z.Id)??"new","is-dialog-visible":e(U),"onUpdate:isDialogVisible":l[9]||(l[9]=n=>g(U)?U.value=n:null),"card-details":e(s),"is-edit-mode":e(C),"opt-unit":e(f),unit:e(c),onReload:e(r)},null,8,["is-dialog-visible","card-details","is-edit-mode","opt-unit","unit","onReload"])),t(me,{"is-dialog-visible":e(D),"onUpdate:isDialogVisible":l[10]||(l[10]=n=>g(D)?D.value=n:null),title:"Upload Excel Unit","api-url":"/api/UploadLaporan/ImportExcel",onReload:e(r)},null,8,["is-dialog-visible","onReload"]),t(pe,{"is-dialog-visible":e(w),"onUpdate:isDialogVisible":l[11]||(l[11]=n=>g(w)?w.value=n:null),"confirmation-question":"Apakah Anda yakin ingin menghapus data ini?","confirm-title":"Data Terhapus!","confirm-msg":"Data telah berhasil dihapus.","cancel-title":"Dibatalkan","cancel-msg":"Penghapusan dibatalkan.","confirm-text":"Ya, Hapus","cancel-text":"Batal","confirm-color":"error",onConfirm:re},null,8,["is-dialog-visible"])],64)}}});export{ua as default};
