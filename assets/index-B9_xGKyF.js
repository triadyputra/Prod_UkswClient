import{f as ce}from"./dateUtils-CBqjUJMf.js";import{V as fe,_ as ve,a as ge}from"./VSnackbar-BlvgPhG8.js";import{_ as be}from"./FormUpload.vue_vue_type_style_index_0_lang-BcYdOxtk.js";import{_ as Ve}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-7GIVTkG9.js";import{_ as Y}from"./AppTextField.vue_vue_type_script_setup_true_lang-DyTkVLXo.js";import{_ as Z,c as Ue,V as Ce,a as _e}from"./VDataTableServer-CydhH6eb.js";import{d as J,r as u,ay as H,w as h,G as ke,c as W,b as t,f as d,m as e,a2 as g,F as ee,e as M,v as R,$ as De,g as K,l as B,a0 as L,t as N,o as E,ad as ye,az as Ne,aA as Ae,X as Q,a as Ie,Z as X}from"./index-BNa8Zz1m.js";import{V as Pe,$ as ae}from"./api-Bdh3YCOR.js";import{u as F}from"./useApi-DRCa-2hq.js";import{V as we}from"./VDialog-BrQxgecu.js";import{V as te,a as xe,b as Ee}from"./VCard-BSZxM56q.js";import{V as $e}from"./VCardText-BjKykbi8.js";import{V as Me,a as $}from"./VRow-DB6fPz5p.js";import{V as Te}from"./VSpacer-B-w_gHuT.js";import{V as Se}from"./VDivider-CmAQevXm.js";import"./VOverlay--wbpgCWy.js";import"./forwardRefs-B931MWyl.js";import"./VImg-C5MTH-lj.js";import"./VTextField-OXWtipX2.js";import"./VChip-B4HNdsZH.js";import"./VAvatar-8H7Ackmy.js";import"./VList-CToLNfeo.js";import"./VMenu-DXpfONEV.js";import"./index-C4wfZp0O.js";import"./_commonjsHelpers-D6-XlEtG.js";/* empty css              */const Ke={class:"text-h4 mb-2"},Re=J({__name:"FormLaporan",props:{cardDetails:{default:()=>({Id:"",Periode:"",Kode:"",Nama:"",Nilai:0,UnitId:""})},isDialogVisible:{type:Boolean},isEditMode:{type:Boolean,default:!1},optUnit:{default:()=>[]},unit:{default:null}},emits:["submit","update:isDialogVisible","reload"],setup(O,{emit:A}){const p=O,I=A,V=u(!1),c=u(""),f=u("success"),o=u(structuredClone(H(p.cardDetails))),k=u(p.optUnit??[]),U=u([]),C=u(p.unit??null),_=u(!1);h(()=>p.cardDetails,s=>{o.value=structuredClone(H(s))},{deep:!0,immediate:!0}),h(()=>p.optUnit,s=>{k.value=s??[]},{immediate:!0});const D=s=>{I("update:isDialogVisible",s)},P=async()=>{var s,a,m;try{if(_.value=!0,!o.value.Periode){c.value="Periode harus diisi",f.value="error",V.value=!0;return}if(!o.value.Kode){c.value="Kode COA harus diisi",f.value="error",V.value=!0;return}const b={Id:o.value.Id,Periode:o.value.Periode,Kode:o.value.Kode,Nilai:o.value.Nilai,UnitId:C.value??o.value.UnitId},w=p.isEditMode?"PUT":"POST",x=p.isEditMode?`api/UploadLaporan/${o.value.Id}`:"api/UploadLaporan",r=await ae(x,{method:w,body:b});((s=r==null?void 0:r.Metadata)==null?void 0:s.Code)==="200"?(c.value=((a=r==null?void 0:r.Metadata)==null?void 0:a.Message)||"Berhasil disimpan!",f.value="success",V.value=!0,I("reload"),I("submit",o.value),I("update:isDialogVisible",!1)):(c.value=((m=r==null?void 0:r.Metadata)==null?void 0:m.Message)||"Terjadi kesalahan!",f.value="error",V.value=!0)}catch(b){console.error("Gagal submit order:",b),c.value="Gagal submit order!",f.value="error",V.value=!0}finally{_.value=!1}};async function y(s){console.log("Panggil");const a=s||C.value||o.value.UnitId;if(!a){console.warn("⚠️ UnitId tidak tersedia, fetch COA dibatalkan.");return}try{const m=`/api/combo/ComboCoaUnit?unit=${encodeURIComponent(a)}`,b=await F(m);console.log("Respon Data COA:",b),U.value=b.data.value}catch(m){console.error("❌ Error Fetch COA:",m),U.value=[]}}return h(()=>o.value.UnitId,(s,a)=>{s&&s!==a&&y(s)},{immediate:!0}),ke(()=>{const s=o.value.UnitId||C.value;s&&y(s),console.log(s)}),(s,a)=>{const m=ve,b=Z,w=Y,x=Ve;return E(),W(ee,null,[t(we,{width:s.$vuetify.display.smAndDown?"auto":600,"model-value":p.isDialogVisible,"onUpdate:modelValue":D},{default:d(()=>[t(m,{onClick:a[0]||(a[0]=r=>D(!1))}),t(te,{class:"pa-2 pa-sm-10"},{default:d(()=>[t(xe,{class:"text-center"},{default:d(()=>[t(Ee,null,{default:d(()=>[M("h4",Ke,R(p.isEditMode?"EDIT LAPORAN KEUANGAN":"ADD LAPORAN KEUANGAN"),1)]),_:1})]),_:1}),t($e,{class:"pt-6"},{default:d(()=>[t(Pe,{onSubmit:De(P,["prevent"])},{default:d(()=>[t(Me,null,{default:d(()=>[t($,{cols:"12"},{default:d(()=>[e(C)?B("",!0):(E(),K(b,{key:0,modelValue:e(o).UnitId,"onUpdate:modelValue":a[1]||(a[1]=r=>e(o).UnitId=r),label:"Unit / Entitas",placeholder:"Pilih Unit / Entitas",items:e(k),autocomplete:"off"},null,8,["modelValue","items"]))]),_:1}),t($,{cols:"12"},{default:d(()=>[t(w,{modelValue:e(o).Periode,"onUpdate:modelValue":a[2]||(a[2]=r=>e(o).Periode=r),label:"Periode",placeholder:"112025",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t($,{cols:"12"},{default:d(()=>[t(x,{modelValue:e(o).Kode,"onUpdate:modelValue":a[3]||(a[3]=r=>e(o).Kode=r),label:"Kode Coa",items:e(U),"item-title":"title","item-value":"value",placeholder:"Pilih Salah satu",clearable:"","clear-icon":"tabler-x",autocomplete:"off"},null,8,["modelValue","items"])]),_:1}),t($,{cols:"12"},{default:d(()=>[t(w,{modelValue:e(o).Nilai,"onUpdate:modelValue":a[4]||(a[4]=r=>e(o).Nilai=r),label:"Nilai",type:"number",placeholder:"112025",autocomplete:"off"},null,8,["modelValue"])]),_:1}),t($,{cols:"12",class:"text-center"},{default:d(()=>[t(L,{class:"me-4",type:"submit",loading:e(_)},{default:d(()=>a[7]||(a[7]=[N(" Submit ")])),_:1,__:[7]},8,["loading"]),t(L,{color:"secondary",variant:"tonal",onClick:a[5]||(a[5]=r=>D(!1))},{default:d(()=>a[8]||(a[8]=[N(" Cancel ")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),t(fe,{modelValue:e(V),"onUpdate:modelValue":a[6]||(a[6]=r=>g(V)?V.value=r:null),transition:"scale-transition",location:"top end",variant:"flat",color:e(f),timeout:1e3},{default:d(()=>[N(R(e(c)),1)]),_:1},8,["modelValue","color"])],64)}}}),Le={class:"d-flex flex-wrap gap-4 ma-6"},he={class:"d-flex align-center"},Be={class:"d-flex gap-4 flex-wrap align-center"},ca=J({__name:"index",async setup(O){var j;let A,p;const I=[{title:"Periode",key:"Periode",sortable:!1},{title:"Kode COA",key:"Kode",sortable:!1},{title:"Nama COA",key:"Nama",sortable:!1},{title:"Nilai",key:"Nilai",sortable:!1,align:"end"},{title:"Unit / Entitas",key:"Unit",sortable:!1},{title:"Actions",key:"actions",sortable:!1,width:"5%"}],c=(j=ye("userData").value)==null?void 0:j.unit,f=u([]),o=u(null),k=u(!1),U=u(!1),C=u(!1),_=u(""),D=u([]),P=u(!1),y=u(null),s=u({Id:"",Periode:"",Kode:"",Nama:"",Nilai:0,UnitId:""}),a=u(10),m=u(1);async function b(){try{const i=await F("/api/combo/ComboUnit");i!=null&&i.data?f.value=i.data.value??[]:(f.value=[],console.warn("Data cabang kosong atau tidak valid:",i)),console.log("Respon cabang:",i)}catch(i){i instanceof Error?(console.error("Error:",i.message),i.message.includes("Failed to fetch")&&console.error("Server tidak dapat dijangkau. Periksa koneksi backend atau CORS.")):console.error("Error tak terduga:",i)}finally{console.log("Fetch cabang selesai.")}}const w=Ne({filter:_,unit:c??o,page:m,pageSize:a}),{data:x,execute:r}=([A,p]=Ae(()=>F(Ue("/api/UploadLaporan/GetListLaporan",{query:w}))),A=await A,p(),A),le=Q(()=>{var i;return((i=x.value)==null?void 0:i.Data)??[]}),G=Q(()=>{var i;return((i=x.value)==null?void 0:i.TotalCount)??0}),oe=()=>{k.value=!0},ie=()=>{s.value={Id:"",Periode:"",Kode:"",Nama:"",Nilai:0,UnitId:""},C.value=!1,U.value=!0},ne=i=>{s.value={...i},C.value=!0,U.value=!0},se=i=>{y.value=i,P.value=!0},re=async i=>{var l,T;if(!(!i||!y.value))try{const v=await ae(`/api/UploadLaporan/${y.value.Id}`,{method:"DELETE"});((l=v==null?void 0:v.Metadata)==null?void 0:l.Code)==="200"?await r():console.error("Gagal menghapus data:",(T=v==null?void 0:v.Metadata)==null?void 0:T.Message)}catch(v){console.error("Terjadi kesalahan koneksi ke server:",v)}finally{y.value=null}};return b(),(i,l)=>{var z;const T=Y,v=Z,q=Ie("IconBtn"),de=_e,ue=Re,me=be,pe=ge;return E(),W(ee,null,[M("div",null,[t(te,{title:"Laporan Keuangan",class:"mb-6"},{default:d(()=>[M("div",Le,[M("div",he,[t(T,{modelValue:e(_),"onUpdate:modelValue":l[0]||(l[0]=n=>g(_)?_.value=n:null),placeholder:"Cari Data",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),e(c)?B("",!0):(E(),K(v,{key:0,modelValue:e(o),"onUpdate:modelValue":l[1]||(l[1]=n=>g(o)?o.value=n:null),placeholder:"Pilih Unit / Entitas",items:e(f)},null,8,["modelValue","items"])),t(Te),M("div",Be,[t(v,{modelValue:e(a),"onUpdate:modelValue":l[2]||(l[2]=n=>g(a)?a.value=n:null),items:[5,10,20,25,50]},null,8,["modelValue"]),e(c)?(E(),K(L,{key:0,color:"primary","prepend-icon":"tabler-file-upload",onClick:l[3]||(l[3]=()=>oe())},{default:d(()=>l[12]||(l[12]=[N(" Upload ")])),_:1,__:[12]})):B("",!0),t(L,{color:"primary","prepend-icon":"tabler-plus",onClick:l[4]||(l[4]=()=>ie())},{default:d(()=>l[13]||(l[13]=[N(" Tambah ")])),_:1,__:[13]})])]),t(Se,{class:"mt-4"}),t(Ce,{"items-per-page":e(a),"onUpdate:itemsPerPage":l[6]||(l[6]=n=>g(a)?a.value=n:null),"model-value":e(D),"onUpdate:modelValue":l[7]||(l[7]=n=>g(D)?D.value=n:null),page:e(m),"onUpdate:page":l[8]||(l[8]=n=>g(m)?m.value=n:null),headers:I,items:e(le),"items-length":e(G),class:"text-no-wrap"},{"item.Unit":d(({item:n})=>{var S;return[N(R((S=n.MasterUnit)==null?void 0:S.Nama),1)]}),"item.Nilai":d(({item:n})=>[N(R(("formatNumber"in i?i.formatNumber:e(ce))(n.Nilai)),1)]),"item.actions":d(({item:n})=>[t(q,null,{default:d(()=>[t(X,{icon:"tabler-edit",onClick:S=>ne(n)},null,8,["onClick"])]),_:2},1024),t(q,null,{default:d(()=>[t(X,{icon:"tabler-trash",color:"error",onClick:S=>se(n)},null,8,["onClick"])]),_:2},1024)]),bottom:d(()=>[t(de,{page:e(m),"onUpdate:page":l[5]||(l[5]=n=>g(m)?m.value=n:null),"items-per-page":e(a),"total-items":e(G)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1})]),(E(),K(ue,{key:((z=e(s))==null?void 0:z.Id)??"new","is-dialog-visible":e(U),"onUpdate:isDialogVisible":l[9]||(l[9]=n=>g(U)?U.value=n:null),"card-details":e(s),"is-edit-mode":e(C),"opt-unit":e(f),unit:e(c),onReload:e(r)},null,8,["is-dialog-visible","card-details","is-edit-mode","opt-unit","unit","onReload"])),t(me,{"is-dialog-visible":e(k),"onUpdate:isDialogVisible":l[10]||(l[10]=n=>g(k)?k.value=n:null),title:"Upload Excel Unit","api-url":"/api/UploadLaporan/ImportExcel",onReload:e(r)},null,8,["is-dialog-visible","onReload"]),t(pe,{"is-dialog-visible":e(P),"onUpdate:isDialogVisible":l[11]||(l[11]=n=>g(P)?P.value=n:null),"confirmation-question":"Apakah Anda yakin ingin menghapus data ini?","confirm-title":"Data Terhapus!","confirm-msg":"Data telah berhasil dihapus.","cancel-title":"Dibatalkan","cancel-msg":"Penghapusan dibatalkan.","confirm-text":"Ya, Hapus","cancel-text":"Batal","confirm-color":"error",onConfirm:re},null,8,["is-dialog-visible"])],64)}}});export{ca as default};
