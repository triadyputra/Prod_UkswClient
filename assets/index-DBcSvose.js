import{V as ca,_ as fa,a as va}from"./VSnackbar-iehoD4iR.js";import{_ as ga}from"./FormUpload.vue_vue_type_style_index_0_lang-BNodi0Cw.js";import{_ as Z,c as Ca,V as ba,a as Va}from"./VDataTableServer-CvaayqLI.js";import{_ as Ua}from"./AppAutocomplete.vue_vue_type_script_setup_true_lang-2NBGO_Ox.js";import{_ as J}from"./AppTextField.vue_vue_type_script_setup_true_lang-D4kmOkS7.js";import{d as W,r as u,ay as L,w as H,c as aa,b as e,f as r,m as a,a2 as C,F as ea,e as S,v as O,$ as ya,g as h,l as R,a0 as F,t as $,o as N,ad as ka,az as _a,aA as Da,X as Q,a as Ma,Z as X}from"./index-CfGr7fxM.js";import{V as Aa,$ as ta}from"./api-C8ws2ADT.js";import{u as B}from"./useApi-C0mHdd6N.js";import{V as wa}from"./VDialog-BhRlawkS.js";import{V as la,a as xa,b as Ia}from"./VCard-CoFJ3VGH.js";import{V as Ea}from"./VCardText-DO2Slsmo.js";import{V as Na,a as P}from"./VRow-BcSiJiKb.js";import{V as $a}from"./VSpacer-Cp4UMCvi.js";import{V as Pa}from"./VDivider-C2MDwIC0.js";import"./VOverlay-_lY9Rmx9.js";import"./forwardRefs-B931MWyl.js";import"./VImg-DjeIU0LB.js";import"./VTextField-md1QIUMW.js";import"./VChip-DD7TiWK_.js";import"./VAvatar-CYHDSwcG.js";import"./index-C4wfZp0O.js";import"./_commonjsHelpers-D6-XlEtG.js";import"./VList-C7PTRKj5.js";import"./VMenu-DelKjUG5.js";/* empty css              */const Sa={class:"text-h4 mb-2"},Ta=W({__name:"FormMapping",props:{cardDetails:{default:()=>({Id:"",CoaUnit:"",Nama:"",CoaYayasan:"",UnitId:""})},isDialogVisible:{type:Boolean},isEditMode:{type:Boolean,default:!1},optUnit:{default:()=>[]},unit:{default:null}},emits:["submit","update:isDialogVisible","reload"],setup(G,{emit:A}){const p=G,w=A,b=u(!1),c=u(""),f=u("success"),o=u(structuredClone(L(p.cardDetails))),y=u(p.unit??null),V=u(p.optUnit??[]),k=u([]);H(()=>p.cardDetails,i=>{o.value=structuredClone(L(i))},{deep:!0,immediate:!0}),H(()=>p.optUnit,i=>{V.value=i??[]},{immediate:!0});const U=u(!1),_=i=>{w("update:isDialogVisible",i)},x=async()=>{var i,l,v,D;try{if(U.value=!0,o.value.CoaUnit===null||o.value.CoaUnit===""){c.value="Kode COA harus diisi",f.value="error",b.value=!0;return}if(o.value.Nama===null||o.value.Nama===""){c.value="Nama COA harus diisi",f.value="error",b.value=!0;return}if(o.value.CoaYayasan===null||o.value.CoaYayasan===""){c.value="Kode Coa Yayasan harus diisi",f.value="error",b.value=!0;return}const M={Id:o.value.Id,CoaUnit:o.value.CoaUnit,Nama:o.value.Nama,CoaYayasan:o.value.CoaYayasan,UnitId:y.value??o.value.UnitId},E=p.isEditMode?"PUT":"POST",d=p.isEditMode?`api/MappingCoa/${o.value.Id}`:"api/MappingCoa",m=await ta(d,{method:E,body:M});((i=m==null?void 0:m.Metadata)==null?void 0:i.Code)==="200"?(c.value=((l=m==null?void 0:m.Metadata)==null?void 0:l.Message)||"Terjadi kesalahan!",f.value="success",b.value=!0,w("reload"),w("submit",o.value),w("update:isDialogVisible",!1)):(console.log((v=m==null?void 0:m.Metadata)==null?void 0:v.Message),c.value=((D=m==null?void 0:m.Metadata)==null?void 0:D.Message)||"Terjadi kesalahan!",f.value="error",b.value=!0)}catch(M){console.error("Gagal submit order:",M),c.value="Gagal submit order!",f.value="error",b.value=!0}finally{U.value=!1}};async function I(){try{const i=await B("/api/combo/ComboCoaYayasan");i!=null&&i.data?k.value=i.data.value:(k.value=[],console.warn("Data cabang kosong atau tidak valid:",i)),console.log("Respon Data:",i)}catch(i){i instanceof Error?(console.error("Error:",i.message),i.message.includes("Failed to fetch")&&console.error("Server tidak dapat dijangkau. Periksa koneksi backend atau CORS.")):console.error("Error tak terduga:",i)}finally{console.log("Fetch cabang selesai.")}}return I(),(i,l)=>{const v=fa,D=J,M=Ua,E=Z;return N(),aa(ea,null,[e(wa,{width:i.$vuetify.display.smAndDown?"auto":600,"model-value":p.isDialogVisible,"onUpdate:modelValue":_},{default:r(()=>[e(v,{onClick:l[0]||(l[0]=d=>_(!1))}),e(la,{class:"pa-2 pa-sm-10"},{default:r(()=>[e(xa,{class:"text-center"},{default:r(()=>[e(Ia,null,{default:r(()=>[S("h4",Sa,O(p.isEditMode?"EDIT MAPPING COA":"ADD MAPPING COA"),1)]),_:1})]),_:1}),e(Ea,{class:"pt-6"},{default:r(()=>[e(Aa,{onSubmit:ya(x,["prevent"])},{default:r(()=>[e(Na,null,{default:r(()=>[e(P,{cols:"12"},{default:r(()=>[e(D,{modelValue:a(o).CoaUnit,"onUpdate:modelValue":l[1]||(l[1]=d=>a(o).CoaUnit=d),label:"Kode Coa",placeholder:"01",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(P,{cols:"12"},{default:r(()=>[e(D,{modelValue:a(o).Nama,"onUpdate:modelValue":l[2]||(l[2]=d=>a(o).Nama=d),label:"Nama",placeholder:"Asset",autocomplete:"off"},null,8,["modelValue"])]),_:1}),e(P,{cols:"12"},{default:r(()=>[e(M,{modelValue:a(o).CoaYayasan,"onUpdate:modelValue":l[3]||(l[3]=d=>a(o).CoaYayasan=d),label:"Kode Coa Yayasan",items:a(k),"item-title":"title","item-value":"value",placeholder:"Pilih Salah satu",clearable:"","clear-icon":"tabler-x"},null,8,["modelValue","items"])]),_:1}),e(P,{cols:"12"},{default:r(()=>[a(y)?R("",!0):(N(),h(E,{key:0,modelValue:a(o).UnitId,"onUpdate:modelValue":l[4]||(l[4]=d=>a(o).UnitId=d),label:"Unit / Entitas",placeholder:"Pilih Unit / Entitas",items:a(V),autocomplete:"off"},null,8,["modelValue","items"]))]),_:1}),e(P,{cols:"12",class:"text-center"},{default:r(()=>[e(F,{class:"me-4",type:"submit",loading:a(U)},{default:r(()=>l[7]||(l[7]=[$(" Submit ")])),_:1,__:[7]},8,["loading"]),e(F,{color:"secondary",variant:"tonal",onClick:l[5]||(l[5]=d=>_(!1))},{default:r(()=>l[8]||(l[8]=[$(" Cancel ")])),_:1,__:[8]})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["width","model-value"]),e(ca,{modelValue:a(b),"onUpdate:modelValue":l[6]||(l[6]=d=>C(b)?b.value=d:null),transition:"scale-transition",location:"top end",variant:"flat",color:a(f),timeout:1e3},{default:r(()=>[$(O(a(c)),1)]),_:1},8,["modelValue","color"])],64)}}}),Ya={class:"d-flex flex-wrap gap-4 ma-6"},ha={class:"d-flex align-center"},Fa={class:"d-flex gap-4 flex-wrap align-center"},de=W({__name:"index",async setup(G){var j;let A,p;const w=[{title:"Unit / Entitas",key:"Unit",sortable:!1},{title:"Kode COA",key:"CoaUnit",sortable:!1},{title:"Nama COA",key:"Nama",sortable:!1},{title:"Kode COA Yayasan",key:"CoaYayasan",sortable:!1},{title:"Actions",key:"actions",sortable:!1,width:"5%"}],c=(j=ka("userData").value)==null?void 0:j.unit,f=u([]),o=u(null),y=u(!1),V=u(!1),k=u(!1),U=u(""),_=u([]),x=u(!1),I=u(null),i=u({Id:"",CoaUnit:"",Nama:"",CoaYayasan:"",UnitId:""}),l=u(10),v=u(1);async function D(){try{const n=await B("/api/combo/ComboUnit");n!=null&&n.data?f.value=n.data.value??[]:(f.value=[],console.warn("Data cabang kosong atau tidak valid:",n)),console.log("Respon cabang:",n)}catch(n){n instanceof Error?(console.error("Error:",n.message),n.message.includes("Failed to fetch")&&console.error("Server tidak dapat dijangkau. Periksa koneksi backend atau CORS.")):console.error("Error tak terduga:",n)}finally{console.log("Fetch cabang selesai.")}}const M=_a({filter:U,unit:c??o,page:v,pageSize:l}),{data:E,execute:d}=([A,p]=Da(()=>B(Ca("/api/MappingCoa/GetListMapping",{query:M}))),A=await A,p(),A),m=Q(()=>{var n;return((n=E.value)==null?void 0:n.Data)??[]}),K=Q(()=>{var n;return((n=E.value)==null?void 0:n.TotalCount)??0}),oa=()=>{y.value=!0},ia=()=>{i.value={Id:"",CoaUnit:"",Nama:"",CoaYayasan:"",UnitId:""},k.value=!1,V.value=!0},na=n=>{i.value={...n},k.value=!0,V.value=!0},sa=n=>{I.value=n,x.value=!0},ra=async n=>{var t,T;if(!(!n||!I.value))try{const g=await ta(`/api/MappingCoa/${I.value.Id}`,{method:"DELETE"});((t=g==null?void 0:g.Metadata)==null?void 0:t.Code)==="200"?await d():console.error("Gagal menghapus data:",(T=g==null?void 0:g.Metadata)==null?void 0:T.Message)}catch(g){console.error("Terjadi kesalahan koneksi ke server:",g)}finally{I.value=null}};return D(),(n,t)=>{var z;const T=J,g=Z,q=Ma("IconBtn"),ua=Va,da=Ta,ma=ga,pa=va;return N(),aa(ea,null,[S("div",null,[e(la,{title:"Mapping COA",class:"mb-6"},{default:r(()=>[S("div",Ya,[S("div",ha,[e(T,{modelValue:a(U),"onUpdate:modelValue":t[0]||(t[0]=s=>C(U)?U.value=s:null),placeholder:"Cari Data",style:{"inline-size":"200px"},class:"me-3"},null,8,["modelValue"])]),a(c)?R("",!0):(N(),h(g,{key:0,modelValue:a(o),"onUpdate:modelValue":t[1]||(t[1]=s=>C(o)?o.value=s:null),placeholder:"Pilih Unit / Entitas",items:a(f)},null,8,["modelValue","items"])),e($a),S("div",Fa,[e(g,{modelValue:a(l),"onUpdate:modelValue":t[2]||(t[2]=s=>C(l)?l.value=s:null),items:[5,10,20,25,50]},null,8,["modelValue"]),a(c)?(N(),h(F,{key:0,color:"primary","prepend-icon":"tabler-file-upload",onClick:t[3]||(t[3]=()=>oa())},{default:r(()=>t[12]||(t[12]=[$(" Upload ")])),_:1,__:[12]})):R("",!0),e(F,{color:"primary","prepend-icon":"tabler-plus",onClick:t[4]||(t[4]=()=>ia())},{default:r(()=>t[13]||(t[13]=[$(" Tambah ")])),_:1,__:[13]})])]),e(Pa,{class:"mt-4"}),e(ba,{"items-per-page":a(l),"onUpdate:itemsPerPage":t[6]||(t[6]=s=>C(l)?l.value=s:null),"model-value":a(_),"onUpdate:modelValue":t[7]||(t[7]=s=>C(_)?_.value=s:null),page:a(v),"onUpdate:page":t[8]||(t[8]=s=>C(v)?v.value=s:null),headers:w,items:a(m),"items-length":a(K),class:"text-no-wrap"},{"item.Unit":r(({item:s})=>{var Y;return[$(O((Y=s.MasterUnit)==null?void 0:Y.Nama),1)]}),"item.actions":r(({item:s})=>[e(q,null,{default:r(()=>[e(X,{icon:"tabler-edit",onClick:Y=>na(s)},null,8,["onClick"])]),_:2},1024),e(q,null,{default:r(()=>[e(X,{icon:"tabler-trash",color:"error",onClick:Y=>sa(s)},null,8,["onClick"])]),_:2},1024)]),bottom:r(()=>[e(ua,{page:a(v),"onUpdate:page":t[5]||(t[5]=s=>C(v)?v.value=s:null),"items-per-page":a(l),"total-items":a(K)},null,8,["page","items-per-page","total-items"])]),_:1},8,["items-per-page","model-value","page","items","items-length"])]),_:1})]),(N(),h(da,{key:((z=a(i))==null?void 0:z.Id)??"new","is-dialog-visible":a(V),"onUpdate:isDialogVisible":t[9]||(t[9]=s=>C(V)?V.value=s:null),"card-details":a(i),"is-edit-mode":a(k),"opt-unit":a(f),unit:a(c),onReload:a(d)},null,8,["is-dialog-visible","card-details","is-edit-mode","opt-unit","unit","onReload"])),e(ma,{"is-dialog-visible":a(y),"onUpdate:isDialogVisible":t[10]||(t[10]=s=>C(y)?y.value=s:null),title:"Upload Excel Unit","api-url":"/api/MappingCoa/ImportExcel",onReload:a(d)},null,8,["is-dialog-visible","onReload"]),e(pa,{"is-dialog-visible":a(x),"onUpdate:isDialogVisible":t[11]||(t[11]=s=>C(x)?x.value=s:null),"confirmation-question":"Apakah Anda yakin ingin menghapus data ini?","confirm-title":"Data Terhapus!","confirm-msg":"Data telah berhasil dihapus.","cancel-title":"Dibatalkan","cancel-msg":"Penghapusan dibatalkan.","confirm-text":"Ya, Hapus","cancel-text":"Batal","confirm-color":"error",onConfirm:ra},null,8,["is-dialog-visible"])],64)}}});export{de as default};
